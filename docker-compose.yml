services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "3001:3000"
    env_file:
      - ./backend/.env
    networks:
      - retro-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: ${FRONTEND_TARGET:-stage-prod}  # Use 'stage-dev' or 'stage-prod'
    ports:
      - "3000:3000"
    environment:
      - NUXT_PUBLIC_API_BASE=http://localhost:3001/api
    volumes:
      # Mount source code for hot-reloading in development mode
      # These are ignored in production mode since it uses built files
      - ./frontend:/app
      - /app/node_modules
      - /app/.nuxt
      - /app/.output
    networks:
      - retro-network
    depends_on:
      - backend

networks:
  retro-network:
    driver: bridge
