services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
      target: ${BACKEND_TARGET:-stage-dev}
    ports:
      - "3001:3001"  # Maps host:3001 to container:3001 (matches PORT env var)
    env_file:
      - ./backend/.env
    volumes:
      - ./backend:/app
      - /app/node_modules
    networks:
      - retro-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      target: ${FRONTEND_TARGET:-stage-prod}  # Use 'stage-dev' or 'stage-prod'
    ports:
      - "3000:3000"
    env_file:
      - ./frontend/.env
    volumes:
      # Mount source code for hot-reloading in development mode
      # These are ignored in production mode since it uses built files
      - ./frontend:/app
      - /app/node_modules
      - /app/.nuxt
      - /app/.output
    networks:
      - retro-network
    depends_on:
      - backend

networks:
  retro-network:
    driver: bridge
